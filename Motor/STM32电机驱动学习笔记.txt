1，直流有刷电机(DC)
	H桥(三极管)、电压、电流电路-运放
	编码器及定时器溢出，PID(控制周期)-香农采样(采样f=2信号f)、实际值突变能力，冒泡排序，一阶低通滤波(滤波系数0~1)。
	1ms进行脉冲读取->5ms进行脉冲变化(速度)->2(10ms)进行速度滤波：冒泡+一阶低通滤波->50ms进行PID控制。
	速度环、电流环、角度环控制。  PID结果后进行一阶低通滤波pwm。
	舵机20ms的PWM，脉宽0.5~2.5ms，0~180。  注：控制电平要和实际硬件电路联系起来，选择合适的PWM模式！
	PWM2(信号反向)
	
2，步进电机
	位置-脉冲个数，转速-脉冲频率。
	细分驱动(电流)，DIR+EN+SPEED。
	PWM-ARR改变频率，翻转模式-CCR改变频率。
	角度->脉冲数->CC中断改变脉冲数(2次进入中断一个脉冲)。
	梯形加减速：频率加-均匀-减。周期T的计算->加速与减速的步数  速度和步数->运动阶段  步数=脉冲数。
	S型加减速：加加速阶段步数-减加速阶段步数-确认下一个脉冲周期。
	直线插补：至少2步进-多运动轴，分配驱动脉冲。  X+Y合成。 偏差。
	曲线插补：X-Y分布走。
	闭环系统：编码器

3，直流无刷电机
	方波驱动-BLDC，正弦波-PMSM。
	六步换相：UVW->PWM调制->位置检测。
	电角度=机械角度*极对数。
	有感BLDC-逆变电路、PWM上桥臂、HALL及真值表。
	函数指针的使用。  RPM-圈/min。
	双环控制：电流环+转速环。  有感UVW-HUVW
	无感驱动：UVW，反电动势过零点检测与换相(延迟30°导通换相)，运放比较器与中性点电路设计。  比较器信号->HALL信号。
开环加速->闭环换相。磁极对数->电角度->比较器的脉冲(电流)频率。
无刷直流电机无感控制：速度闭环、速度+电流双闭环。   电流环->主要针对有负载。
	SPWM:面积等效(方波->正弦波  等幅不等宽)-傅里叶级数   正弦波->由方波w等,调宽(占空比)级数叠加  占空比=1/T  T=1/f
	SVPWM:平均值等效原理
4，FOC实战
	UVW三相同时导通，常用永磁直流无刷电机(PMSM)-反电动势-正弦波。 SVPWM合成电压空间矢量。(SPWM仅是针对单相)
磁场矢量控制方法。  


5，
	(1)死区-上下管，COM事件-6步-接口定时器(HALL)-TRGI，BEMF=U-压降，接口定时器(计数CNT-捕获、主从、延时动作CCR2-PWM2)-控制定时器-主从及复位-TRGO(换向)，HALL也可以EXTI。
	(2)步进:脉冲数+脉冲频率(脉冲时间间隔=c/f)，步数+加减速度， 定时器计数-第n个脉冲-加减速与平稳， 加减速-步数-脉冲-每一步时间间隔，  手段->定时器CCR
		加速度=c0步进延时--下一个脉冲比较值， 状态机-步数，  输出翻转->中断变更CCR,步进数  设置->执行
	(3)SPWM:调制波(输入信号)、载波(频谱信号)-周期与幅值  (U/I)跟踪控制->滞环环节  中心对齐-CNT作为载波-CCR阈值界(类调制波-脉宽)  
		载波比恒定:1正弦周期内的脉冲数恒定-->查表法调制SPWM  底部采样  同步调制--f同步
	(4)FOC:PMSM-正弦反电动势，n3!组合开关->空间电压矢量->旋转电压->电源角频率,  开关次数-7段/5段,  ap空间坐标系  扇区->矢量T->三相CCR
		调制波(隐含)-相电压/线电压函数-马鞍/正弦
		坐标变换-解耦, 本质:FOC就是把定子电流分解为与转子磁链同相的直轴分量及正交的交轴分量.  Clark:标幺量(U1/Un常用百分数表示),  𝒊𝐝值控制磁通，而𝒊𝐪值控制电机转矩==>转速
		位置与转速:HALL、光电、ABZ位置传感器,  电流滑动控制器SMC--观测器--位置和速度,  反电动势->角度    滤波--需补偿  
		电流矢量控制--最大转矩电流比控制、id*=0控制、弱磁控制(弱反电动势、提速)、cosφ=1控制
		本质:空间位置对力矩的控制   调节磁场->磁力->转矩->转速  T=转子磁场*定子磁场  弱磁控制-恒转矩-恒功率-正弦电流频率
	
		无感PMSM:位置检测算法-Observer+PLL(BEMF)、高频注入算法(IPMSM)。
		TIM1->ADC采样点(P471)---SVPWM调制指数(导通时间反比)、死区时间、噪声时间、采样转换时间
		转子位置信息->PARK/CLEAK     iα和 iβ和转子的位置信息(𝜃𝑟𝑒𝑙)结合计算得到iq和id   电流参考值𝑖𝑞𝑠∗和𝑖𝑑𝑠∗以给FOC_Model函数调用
		IPMSM-内嵌式永磁同步电机-MTPA(IPMSM的最大转矩电流比)=iq/id
		矢量幅值饱和等于|𝑉⃗ ∗| = sqrt(𝑉𝑑∗2 + 𝑉𝑞∗2)---圆限制(合矢量的内切圆)
		PID参数自整定，  !!!SVPWM信号<->BEMF与HALL信号，!!!  周期测量频率1:1000   霍尔信号频率-采样(分辨率)-定时器计数(预分频)
		电频率=磁极对数 x 机械频率   电频率=磁极对数 x 机械频率
		霍尔传感器信号捕获中断服务函数：转子旋转方向确定、 计算电角度、计算新的预分频器值、 更新速度周期 FIFO 缓冲区、 转子电频率计算

		BLDC:集中绕组,BEMF-梯形波,CTR-方波(直流-逆变-交流),直流电机,6步
		PMSM:分布短距绕组,BEMF-正弦波,CTR-三相正弦波(交流),同步电机,FOC

		FOC（Filed Oriented Control）是采用数学方法实现三相马达的力矩与励磁的解耦控制。
主要是对电机的控制电流进行矢量分解，变成励磁电流I d IdId 和交轴电流I q IqIq ，励磁电流主要是产生励磁，控制的是磁场的强度，而交轴电流是用来控制力矩，所以在实际使用过程中，我们常令I d = 0 Id=0Id=0 
		FOC（电机矢量控制）要求严格的转子磁场定向，对于BLDC电机而言转子磁场方向始终与转子位置一致，因此其控制输入需要准确的转子绝对位置信号
DTC（直接转矩控制）实际上与基于定子磁场定向，而定子磁场则是依据电压积分估算获得，在这个过程中跟转子位置没有关系，其控制过程中用到的量也都是静止坐标系下的量，因此DTC控制相比于FOC控制要简单很多，完全不需要求解三角函数、坐标变换，如果需要用DTC进行速度闭环则需要测量电机的速度，但是依然不需要准确的绝对位置。
		本质；矢量控制，它的基本思想就是一致的：将多变量、强耦合、非线性、时变的交流电机复杂矢量系统通过解耦（坐标变换）的方式等效成直流电机的简单标量系统。
		BLDC转矩波动-BENF顶部大于120°,不转矩波动(理论)- 梯形~=正弦 - FOC - 位置信息传感器
	(5)编码器校准:0度相位-定子角度-编码器	预启动(转矩iq和磁通id校准/SVPWM)-加速-运行
	ST-FOC源码分析 2024.2.27


6,本质
	(1)有效非零矢量-作用时间-调制比   abc->ap坐标，引入方向(欧拉变换)  定方向，动大小(作用时间)  电压矢量增加角度  调制比=调制波基波峰值/载波基波峰值
	(2)零矢量平均分配-PWM对称-降低PWM谐波分量   Ts代表载波周期，即开关周期  
	(3)在三相正弦波中注入了零序分量的调制波进行规则采样的一种变形SPWM(调制波-正弦波)  SVPWM(正弦波+零序分量)
	(4)坐标变换、 PID 算法、 SVPWM 技术和新变换角（变相角度）--电机转子位置（𝛉）和速度（𝛚）=>有传感器/无传感器
	(5)电机单相模型->Is->电流观测器->反电动势->位置    theta+w->滤波->延迟->相位补偿
	(6)abc->ap坐标变换,引入方向(欧拉变换)    ap定方向,动大小(作用时间)-->合成矢量反之  (ap-欧拉系)
	(7)有效非零适量-作用时间-调制比(利用率=调制波幅值/载波幅值)  7段式SVPWM/5段式SVPWM  
	(8)定子磁场-扭力 与转子力臂垂直    FOC建模-将转子磁通作为定子和气隙磁通的参考坐标系-力追踪转子位置  SVPWM-电压同步转子位置   励磁/转矩分量
	(9)FOC关键:对电流矢量的幅值和空间位置(频率和相位)的控制    转子磁极位置-逆变器输出频率-转子角频率(异步-同步)  id-转速,iq-转矩(直流)  (定子坐标)电流空间矢量->dq(转子坐标)->反变换->FOC
	(10)电机转矩正比于 转子磁场 叉积 定子磁场.   电流-磁场-力-转矩-速度  U=磁场的微分(dB/dS=U)  磁动势=有效匝数*电流     