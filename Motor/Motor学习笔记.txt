/*
	一、《无刷直流电机控制应用-基于STM8S系列单片机》学习记录
	二、《现代永磁同步电机控制原理及MATLAB仿真》-袁雷
	三、《硬石电机控制专题指导手册》-硬石科技
*/


一、BLDC
/*
	1，环境搭建
	2，

*/

						目标：设计一款BLDC的硬件，同时做出一款BLDC的驱动程序

1，STM32的环境搭建和硬件使用

1)芯片选型：
	STM32F103RCT6，64pin，256K字节的闪存存储器，工业级温度范围-40℃~85℃。 
硬件包括3个USART+2UART、4个16位定时器、2个基本定时器、3个SPI、CAN、2个IIC和IIS、USB、2个PWM定时器、3个ADC、1个DAC等
2)环境搭建:
	首先声明，书本第二章的环境是基于ARM汇编和C进行搭建的，汇编部分偏羞涩难懂，看懂需要很高的微机原理基础，而现在这些工作，ST官方已经基本为各个型号的芯片
做好了ARM汇编的相关文件，叫“启动文件”，如:STM32F103RCT6的启动文件startup_stm32f10x_hd.s。所以我们更多在意C方面的开发。
	调试软件KEIL5，	下载安装及软件的使用请参考网上的资料。
	编程语言，选择C语言开发，强烈推荐《C Prinmer Plus》这本书。这本书看完仍然可以当工具书用，毕竟C语言也是“语言”，可随用随查。

3)硬件上，定时器的PWM、编码器模式、PWM互补输出要好好掌握，注意TIM的TRGO触发ADC和DAC，掌握时钟树RCC，掌握库函数和寄存器的使用。其他硬件模块都可以自己学着做一个小项目进行学习。


	
2，无刷直流电机理论基础
1)电机分类：功率电机->直流、交流、交直  控制电机->无刷直流、力矩、步进、伺服

2)异步电机(交流)：三相/单相。

3)直流电动机：导线框*1+换相器片*2(两者焊接于一起)，配合电刷*2+直流电源+1对磁极->磁+流=安培定则。
定子:U型永久磁铁。 -- 气隙 -- 转子：即电枢，8线槽-8线圈绕组-绕组首尾依次焊接-有效边，换向器*8焊上去，2极8槽电枢绕组展开
1个换向器焊着2端子，达到电流的方向同向(一个磁极下)。
ps：线圈(元件)绕组端部会接触，但通过绕组展开图可知，电流形成极性一致的十字交叉线路
机座(磁轭)，磁路。主磁极套定子励磁绕组-换套换相极绕组=磁极和电刷。
ps：目前小型直流电动机都采用永磁磁体励磁，且采用电子电路换相。

4)三相交流电动机：三相右手定则合成-旋转磁场(每一相均为1维度)，50HZ，附：还可以拿磁力线表示。
转子产生的反电动势对旋转磁场的影响是较大的。
交流电机绕组：定子绕组和转子绕组，一个线圈的两个有效边间隔的槽数称为节距，单层、双层、多层绕组，
磁极对数：N/S下->极距 U/V下->相带(宽)。 设计绕组：相带划分法。  单相交流电机：2相，相带划分-即同一相带下电流方向同，但不同极下反。
三相交流电机绕组：感应电动势与旋转磁场，Y-380V，▲-220V，线电压和相电压。
采用“Y-Δ”起动，在起动时采用Y型接法，起动电流较小，待电动机转速接近额定转速时再改为Δ型接法。

5)同步电动机：旋转磁场和永磁转子转速同步，三相交流同步电机-永磁转子/电励磁转子(直流)，
1个3相定子绕组->1对凸极(电励磁转子)  3个3相定子绕组->3对凸极->大扭矩，低转速。
缺陷：交流同步电机起动不可能同步，采用辅助电动机、变频电源、异步起动。

6)异步电动机：三相交流异步电动机-旋转磁场，转子嵌入鼠笼(铜条切割磁力线-电流)-洛伦磁力，转差，转差轮
转差大则感生电流大，电流大则力大，力大则增加鼠笼转速。转差与力会形成平衡，鼠笼转速将稳定在某一转差值。
交流异步电机没有电刷和换相器。交流电机主要是三相异步电机与三相永磁同步电机两种

交流异步牵引电机-大功率，铁芯会导磁--电势差和短路环。齿轮减速箱(大小齿轮比)-测速。

7)绕线转子感应电动机结构：转子绕组-非笼型，实现简单的起动与调速，用较小的起动电流实现较大的起动力矩。
电刷被压簧片压向集电环-构成三相回路

8)发电电动发电机：两用。

9)电机名词：直流电动机，交流电动机--异步/同步电动机，电动机功率(kW)，铁损(当磁通随时间交变时，铁心中将产生磁滞损耗和涡流损耗)。
机械角度：从几何上把电机圆周分成 360°，为机械角度。
电角度：对于交流电机来说，电枢线圈中感生的按正弦变化的电势的一个周期为360电角度。若电机有p对磁极，电机旋转时的电角度为p×机械角度。
磁极多-转矩大-转矩慢
磁轭，为电机提供磁路

3，永磁电机原理与构造
1)永磁直流电动机：定子-永磁体材料--钕铁硼。

2)盘式永磁直流电动机：永磁体排成平面。

3)永磁同步电动机：永磁转子(内埋)，同步起动-变频调速器，异步起动-笼型绕组、

4)无刷直流永磁同步电动机：3线圈绕组->电子开关(功率开关)+ 转子位置->旋转磁场带动转子
6槽定子铁芯：二相导通星形三相六状态， 转子位置传感器：光电、霍尔
无位置无刷直流永磁电动机：获取转子位置信号--利用线圈产生的反电动势变化来获取转子的位置信号；
通过检测导通线圈的续流二极管状态来获取转子的位置信号。
星形三相十二状态：4个转子位置检测装置

5)12槽8极的分数槽集中绕组永磁电机：3*4个凸极绕组，3个霍尔元件ABC->位置信息->功率开关。
通电-电势差
12槽10极   大转矩低转速。

4，磁阻电机原理与构造
1)开关磁阻电动机原理：转子上没有线圈，这是磁阻电机的主要特点。  
磁阻电动机则是利用磁阻最小原理，也就是磁通总是沿磁阻最小的路径闭合，利用齿极间的吸引力拉动转子旋转。
转子位置-开关ON/OFF时间-

2)4/6凸极发电机：磁通发生变化->定子线圈产生感应电动势->电枢绕组(定子)->输出。
机械角度(物理角度)，电角度(A、B、C相，每相120°)

3)步进电动机：步进角，C、B、A依次通电(直流)-脉冲控制开关，脉冲一停电机就停止转动。
控制脉冲频率高则转子转速高、频率低则转子转速低。

5，电动汽车电机

1)轮边电动机、轮毂电机--永磁无刷直流电动机/电动汽车永磁同步电机/分数槽集中绕组轮毂电机



/* 书籍笔记 */
第4章 无刷直流电机概述
	BLDCM：直流电源->电子换相线路->BLDC->转子位置传感器反馈->电子换相线路
	HALL位置传感器-功率开关-换相
	无位置传感器-反电动势过零点，反映转子磁极位置-换相

第5章 无刷直流电机控制技术
	BLDC的6步换相，转子永磁体，定子电枢绕组-6个功率开关换相。
	换相：有感-霍尔位置传感器，HALL与反电动势EMF判断。二二导通换相-120°HAL换相真值表-绕组通电顺序。
读出HAL和定子电流信号。每个开关连续导通120° 三三导通换相-等效于2个开关开，每个开关连续导通180°。
调压：PWM换相调压，频率(脉宽)-换相-占空比-调压。pwm换相->功率开关管—->控制电路->主回路逆变器输出->电机转。
	无感-反电动势EMF(AD采集过零点)，开关导通采样-硬件取参考电压(无法低pwm)，开关关断采样-纯EMF(无法pwm=100%).
三段式启动-电机转子预定位、外同步加速、自同步运行。  
	位置式PID：控制量-离散化据对值  增量式PID：控制量-增量
	无刷直流电机转速单环控制：M、T、M/T法测速，区分转子位置检测和转速脉冲计算。转速环PI
	无刷直流电机转速双环控制：转速环PI 电流环PI
	Simulink仿真!

第6章 有感无刷直流电机控制实例
	硬件设计：
		电机主控选择->电机驱动设计：120°BLDC->6路PWM->6路功率MOS逆变电路->UVW
		电路设计->PCB设计
	软件设计：
		HALL信号+换相表+PWM，实现换相调压，脉冲由HALL的输入捕获中断计数(向上/向下)和极对数

第7章 无感无刷直流电机控制实例
	硬件设计：I/O分配，电路设计->电源设计(稳压、滤波、保护)、驱动与功率系统电路、反电动势过零检测电路、
运放-比较电路，电流检测与故障保护电路，
	软件设计：三段式启动，

第8章 KIT V1.0 电机库运行原理
	转速-BEMF和极对数/HALL信号，动态BEMF采样(因为ON或OFF采样会出现低速/高速无法满)，快速退磁->上下桥臂采用PWM互补1输出->步序+退磁表实现。
TIM触发ADC采样。
	
第9章 KIT V1.0 电机库运行实例
	硬件设计：控制板设计(下载、稳压、信号)、功率板设计(反电动势、电机驱动、辅助电路-显示和按键等、电源、电流检测、电压检测、)


二、PMSM

第1章 三相永磁同步电机的数学建模
1）自然坐标系-ABC、静止坐标变换(Clark)-ap、同步旋转坐标变换(Park)-dq	，目的采用坐标变换对模型进行降阶和解耦。
2）dq系建模->ap系建模：u、i、T和磁链

第2章 三相电压源逆变器PWM技术
1）SVPWM是开关触发顺序和脉宽大小的组合->120°正弦波电流。  本质为电压空间矢量的旋转-圆->傅里叶变换理论->正弦波
平衡等效原理（分矢量）->作用时间T->生成调制波形（合成矢量）-七段式/五段式->谐波小，开关6/谐波大，开关3
矢量扇区确认->矢量扇区作用时间->扇区切换点->一定频率三角载波和扇区矢量切换点比较，生成pwm脉冲->变换器
2）SPWM算法实现：
常规法：正弦调制信号和三角载波信号幅值比和频率比反比->调制深度、载波比->开关逆变器   三角载波和调制波
三次谐波注入：调制波加入三次谐波分量
零序分量注入：均值零序、极值零序、交替零序信号。

第3章 三相永磁同步电机的矢量控制
1）滞环电流控制、转速-电流环PI控制、PI矢量控制及模型、滑模控制（非线性系统）、比例谐振静止坐标系控制PR及框图。
2）表贴式/内置式PMSM，状态方程和运动方程，微震

第4章 三相永磁同步电机的直接转矩控制
1）

FreeRTOS:
CUBEMX:
x






